!function(e,t,n,i){e.visit=e.fn.visit=function(n){var o,r=e(e.isFunction(this)?t:this),s=r.selector||"",a=(new Date).getTime(),c=[],u=arguments[0],l="string"==typeof u,d=[].slice.call(arguments,1);return r.each(function(){var g,m=e.extend(!0,{},e.fn.visit.settings,n),f=m.error,p=m.namespace,v=p+"-module",h=e(this),b=e(),y=this,k=h.data(v);g={initialize:function(){m.count?g.store(m.key.count,m.count):m.id?g.add.id(m.id):m.increment&&"increment"!==l&&g.increment(),g.add.display(h),g.instantiate()},instantiate:function(){g.verbose("Storing instance of visit module",g),k=g,h.data(v,g)},destroy:function(){g.verbose("Destroying instance"),h.removeData(v)},increment:function(e){var t=g.get.count(),n=+t+1;e?g.add.id(e):(n>m.limit&&!m.surpass&&(n=m.limit),g.debug("Incrementing visits",n),g.store(m.key.count,n))},decrement:function(e){var t=g.get.count(),n=+t-1;e?g.remove.id(e):(g.debug("Removing visit"),g.store(m.key.count,n))},get:{count:function(){return+g.retrieve(m.key.count)||0},idCount:function(e){return e=e||g.get.ids(),e.length},ids:function(e){var t=[];return e=e||g.retrieve(m.key.ids),"string"==typeof e&&(t=e.split(m.delimiter)),g.verbose("Found visited ID list",t),t},storageOptions:function(){var e={};return m.expires&&(e.expires=m.expires),m.domain&&(e.domain=m.domain),m.path&&(e.path=m.path),e}},has:{visited:function(t,n){var o=!1;return n=n||g.get.ids(),t!==i&&n&&e.each(n,function(e,n){n==t&&(o=!0)}),o}},set:{count:function(e){g.store(m.key.count,e)},ids:function(e){g.store(m.key.ids,e)}},reset:function(){g.store(m.key.count,0),g.store(m.key.ids,null)},add:{id:function(e){var t=g.retrieve(m.key.ids),n=t===i||""===t?e:t+m.delimiter+e;g.has.visited(e)?g.debug("Unique content already visited, not adding visit",e,t):e===i?g.debug("ID is not defined"):(g.debug("Adding visit to unique content",e),g.store(m.key.ids,n)),g.set.count(g.get.idCount())},display:function(t){var n=e(t);n.length>0&&!e.isWindow(n[0])&&(g.debug("Updating visit count for element",n),b=b.length>0?b.add(n):n)}},remove:{id:function(t){var n=g.get.ids(),o=[];t!==i&&n!==i&&(g.debug("Removing visit to unique content",t,n),e.each(n,function(e,n){n!==t&&o.push(n)}),o=o.join(m.delimiter),g.store(m.key.ids,o)),g.set.count(g.get.idCount())}},check:{limit:function(e){e=e||g.get.count(),m.limit&&(e>=m.limit&&(g.debug("Pages viewed exceeded limit, firing callback",e,m.limit),m.onLimit.call(y,e)),g.debug("Limit not reached",e,m.limit),m.onChange.call(y,e)),g.update.display(e)}},update:{display:function(e){e=e||g.get.count(),b.length>0&&(g.debug("Updating displayed view count",b),b.html(e))}},store:function(n,o){var r=g.get.storageOptions(o);if("localstorage"==m.storageMethod&&t.localStorage!==i)t.localStorage.setItem(n,o),g.debug("Value stored using local storage",n,o);else{if(e.cookie===i)return void g.error(f.noCookieStorage);e.cookie(n,o,r),g.debug("Value stored using cookie",n,o,r)}n==m.key.count&&g.check.limit(o)},retrieve:function(n){var o;return"localstorage"==m.storageMethod&&t.localStorage!==i?o=t.localStorage.getItem(n):e.cookie!==i?o=e.cookie(n):g.error(f.noCookieStorage),("undefined"==o||"null"==o||o===i||null===o)&&(o=i),o},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,m,t);else{if(n===i)return m[t];m[t]=n}},internal:function(t,n){return g.debug("Changing internal",t,n),n===i?g[t]:void(e.isPlainObject(t)?e.extend(!0,g,t):g[t]=n)},debug:function(){m.debug&&(m.performance?g.performance.log(arguments):(g.debug=Function.prototype.bind.call(console.info,console,m.name+":"),g.debug.apply(console,arguments)))},verbose:function(){m.verbose&&m.debug&&(m.performance?g.performance.log(arguments):(g.verbose=Function.prototype.bind.call(console.info,console,m.name+":"),g.verbose.apply(console,arguments)))},error:function(){g.error=Function.prototype.bind.call(console.error,console,m.name+":"),g.error.apply(console,arguments)},performance:{log:function(e){var t,n,i;m.performance&&(t=(new Date).getTime(),i=a||t,n=t-i,a=t,c.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:y,"Execution Time":n})),clearTimeout(g.performance.timer),g.performance.timer=setTimeout(g.performance.display,100)},display:function(){var t=m.name+":",n=0;a=!1,clearTimeout(g.performance.timer),e.each(c,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",s&&(t+=" '"+s+"'"),r.length>1&&(t+=" ("+r.length+")"),(console.group!==i||console.table!==i)&&c.length>0&&(console.groupCollapsed(t),console.table?console.table(c):e.each(c,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(t,n,r){var s,a,c,u=k;return n=n||d,r=y||r,"string"==typeof t&&u!==i&&(t=t.split(/[\. ]/),s=t.length-1,e.each(t,function(n,o){var r=n!=s?o+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(u[r])&&n!=s)u=u[r];else{if(u[r]!==i)return a=u[r],!1;if(!e.isPlainObject(u[o])||n==s)return u[o]!==i?(a=u[o],!1):!1;u=u[o]}})),e.isFunction(a)?c=a.apply(r,n):a!==i&&(c=a),e.isArray(o)?o.push(c):o!==i?o=[o,c]:c!==i&&(o=c),a}},l?(k===i&&g.initialize(),g.invoke(u)):(k!==i&&g.destroy(),g.initialize())}),o!==i?o:this},e.fn.visit.settings={name:"Visit",debug:!1,verbose:!0,performance:!0,namespace:"visit",increment:!1,surpass:!1,count:!1,limit:!1,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:!1,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}}(jQuery,window,document);